<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Money Calendar – October 2025</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <link rel="stylesheet" href="./styles.css">
    <meta name="robots" content="noindex,nofollow,noarchive">
    <style>
      .cal-wrap { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
      .cal-header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 12px; gap: 8px; }
      .legend { display:flex; flex-wrap: wrap; gap: 8px; font-size: 12px; color: var(--muted); justify-content: center; }
      .legend span { padding: 6px 8px; border-radius: 8px; border: 1px solid var(--border); }
      .income { background:#e6f4ff; color:#1a4d99; border-color:#b3d9ff; }
      .income-payroll { background:#e6f4ff; color:#1a4d99; border-color:#b3d9ff; font-weight: 600; }
      .bill { background:#fff4e5; color:#8a4b00; border-color:#ffd699; }
      .debt { background:#fde8e8; color:#7a1f1f; border-color:#f5bcbc; }
      .uwm-window { background: rgba(255, 193, 7, 0.15); border-color: #ffc107; }
      .uwm-window-end { 
        background: rgba(255, 87, 34, 0.3); 
        border-color: #ff5722; 
        border-width: 3px;
        box-shadow: 0 0 20px rgba(255, 87, 34, 0.4);
        animation: criticalPulse 2s ease-in-out infinite;
      }
      @keyframes criticalPulse {
        0%, 100% { 
          box-shadow: 0 0 20px rgba(255, 87, 34, 0.4);
          transform: scale(1);
        }
        50% { 
          box-shadow: 0 0 30px rgba(255, 87, 34, 0.7);
          transform: scale(1.02);
        }
      }
      .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
      .dow { font-weight: 700; text-align: center; color: var(--muted); }
      .cell { 
        border: 1px solid var(--border); 
        border-radius: 10px; 
        min-height: 120px; 
        padding: 8px; 
        display:flex; 
        flex-direction:column; 
        background:#0c1220; 
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        cursor: pointer;
        position: relative;
      }
      .cell:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border-color: var(--primary);
      }
      .day { font-weight: 700; font-size: 14px; margin-bottom: 6px; color:#e6eefc; }
      ul { list-style: none; padding-left: 0; margin: 0; display:flex; flex-direction:column; gap:4px; }
      li { font-size: 12px; padding: 4px 6px; border-radius: 6px; border:1px solid #eee; background:#fff; color:#222; }
      .totals { margin-top: 16px; font-size: 14px; color: var(--muted); }
      .totals .row { display:flex; justify-content: space-between; margin: 4px 0; }
      .money-in { color:#0d652d; font-weight: 700; }
      .money-out { color:#7a1f1f; font-weight: 700; }
      .balance-badge { 
        position: absolute; 
        right: 6px; 
        bottom: 6px; 
        font-size: 10px; 
        padding: 2px 6px; 
        border-radius: 999px; 
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.9); 
        color: #111; 
        pointer-events: auto;
        white-space: nowrap;
        cursor: help;
        transition: all 0.2s ease;
      }
      .balance-badge:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        z-index: 10;
      }
      .balance-tooltip {
        position: absolute;
        bottom: 100%;
        right: 0;
        background: rgba(0,0,0,0.95);
        color: white;
        padding: 12px 16px;
        border-radius: 12px;
        font-size: 11px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 20;
        pointer-events: auto;
        max-width: 320px;
        white-space: normal;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.1);
      }
      .balance-tooltip-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(255,255,255,0.2);
      }
      .balance-tooltip-title {
        font-weight: bold;
        font-size: 12px;
      }
      .balance-tooltip-close {
        background: none;
        border: none;
        color: rgba(255,255,255,0.7);
        cursor: pointer;
        font-size: 16px;
        line-height: 1;
        padding: 2px 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }
      .balance-tooltip-close:hover {
        background: rgba(255,255,255,0.1);
        color: white;
      }
      .balance-badge:hover .balance-tooltip {
        opacity: 1;
        visibility: visible;
      }
      /* Also show when opened by tap/click (mobile) */
      .balance-badge.open .balance-tooltip {
        opacity: 1;
        visibility: visible;
      }
      
      /* Mobile-specific tooltip visibility */
      @media (max-width: 767px) {
        .balance-badge.open .balance-tooltip {
          opacity: 1 !important;
          visibility: visible !important;
          display: block !important;
        }
      }
      .balance-tooltip .breakdown-line {
        margin: 4px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 2px 0;
      }
      .balance-tooltip .breakdown-line.item {
        background: rgba(255,255,255,0.05);
        padding: 4px 8px;
        border-radius: 6px;
        margin: 2px 0;
      }
      .balance-tooltip .breakdown-positive {
        color: #4CAF50;
        font-weight: 600;
      }
      .balance-tooltip .breakdown-negative {
        color: #F44336;
        font-weight: 600;
      }
      .balance-tooltip .breakdown-total {
        border-top: 2px solid rgba(255,255,255,0.3);
        margin-top: 8px;
        padding-top: 8px;
        font-weight: bold;
        font-size: 12px;
        background: rgba(255,255,255,0.1);
        padding: 8px 12px;
        border-radius: 8px;
        margin-left: -12px;
        margin-right: -12px;
        margin-bottom: -8px;
      }
      .balance-tooltip .breakdown-section {
        margin: 6px 0;
      }
      .balance-tooltip .breakdown-section-title {
        font-size: 10px;
        color: rgba(255,255,255,0.7);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
      }
      .balance-pos { background: rgba(46, 204, 113, 0.15); color: #2ecc71; border-color: rgba(46, 204, 113, 0.5); }
      .balance-low { background: rgba(255, 193, 7, 0.15); color: #ffc107; border-color: rgba(255, 193, 7, 0.5); }
      .balance-neg { background: rgba(244, 67, 54, 0.15); color: #f44336; border-color: rgba(244, 67, 54, 0.5); }
      @media (max-width: 767px) { 
        .calendar { 
          gap: 4px; 
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          padding-bottom: 8px;
          scroll-snap-type: x mandatory;
          scroll-behavior: smooth;
        } 
        .cell { 
          min-height: 100px; 
          min-width: 130px;
          padding: 8px;
          scroll-snap-align: start;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .cell:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .day { font-size: 14px; font-weight: 700; }
        li { font-size: 10px; padding: 3px 5px; line-height: 1.3; }
        .legend { flex-direction: column; gap: 6px; }
        .legend span { text-align: center; font-size: 11px; padding: 4px 6px; }
        .totals { font-size: 13px; }
        .totals .row { flex-direction: column; gap: 2px; text-align: center; }
        
        /* Mobile-specific balance badge improvements */
        .balance-badge { 
          font-size: 9px; 
          padding: 3px 6px; 
          right: 4px; 
          bottom: 4px;
          min-width: 60px;
          text-align: center;
        }
        
        /* Mobile modal popup */
        .balance-modal {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.8);
          z-index: 1000;
          display: none;
          align-items: center;
          justify-content: center;
          padding: 20px;
        }
        
        .balance-modal.open {
          display: flex;
        }
        
        .balance-modal-content {
          background: #1a1a1a;
          border-radius: 16px;
          padding: 20px;
          max-width: 90vw;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0,0,0,0.5);
          border: 1px solid rgba(255,255,255,0.1);
        }
        
        .balance-modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 16px;
          padding-bottom: 12px;
          border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .balance-modal-title {
          font-size: 18px;
          font-weight: bold;
          color: white;
        }
        
        .balance-modal-close {
          background: rgba(255,255,255,0.1);
          border: none;
          color: white;
          font-size: 24px;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        }
        
        .balance-modal-close:hover {
          background: rgba(255,255,255,0.2);
        }
        
        .balance-modal .breakdown-line {
          margin: 8px 0;
          padding: 6px 0;
          font-size: 14px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        
        .balance-modal .breakdown-line.item {
          background: rgba(255,255,255,0.05);
          padding: 8px 12px;
          border-radius: 8px;
          margin: 4px 0;
        }
        
        .balance-modal .breakdown-section-title {
          font-size: 12px;
          color: rgba(255,255,255,0.7);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin: 12px 0 6px 0;
        }
        
        .balance-modal .breakdown-total {
          background: rgba(255,255,255,0.1);
          padding: 12px 16px;
          border-radius: 12px;
          margin-top: 16px;
          font-weight: bold;
          font-size: 16px;
        }
        
        .balance-modal .breakdown-positive {
          color: #4CAF50;
          font-weight: 600;
        }
        
        .balance-modal .breakdown-negative {
          color: #F44336;
          font-weight: 600;
        }
        
        /* Improve touch targets */
        .balance-badge {
          min-height: 24px;
          min-width: 70px;
        }
        
        /* Better mobile scroll hint */
        .mobile-scroll-hint {
          font-size: 14px;
          padding: 8px;
          background: rgba(79, 140, 255, 0.1);
          border-radius: 8px;
          margin-bottom: 12px;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <header class="header">
        <h1>October 2025 – Money Calendar</h1>
        <nav>
          <a class="btn" href="./overview.html">Overview PDF</a>
          <a class="btn secondary" href="./cost-reduction.html">Cost Reduction</a>
          <button id="lock" class="btn secondary" type="button">Lock</button>
        </nav>
      </header>
        <div style="text-align: center; margin-bottom: 20px; padding: 16px; background: rgba(79, 140, 255, 0.1); border: 2px solid #4f8cff; border-radius: 12px;">
          <div style="font-size: 14px; color: var(--muted); margin-bottom: 4px;">Current Balance</div>
          <div style="font-size: 32px; font-weight: 700; color: #4f8cff;">$4,613.18</div>
          <div style="font-size: 12px; color: var(--muted);">as of 10/8/25</div>
        </div>
      <section class="cal-wrap">
        <div class="cal-header">
          <div class="legend">
            <span class="income">Money In (Blue)</span>
            <span class="bill">Bill / Subscription</span>
            <span class="debt">Debt Payment</span>
            <span class="uwm-window">UWM Window (1-16)</span>
            <span class="uwm-window-end">⚠️ CRITICAL: Mortgage Window Ends (16th)</span>
          </div>
        </div>
        <div class="mobile-scroll-hint" style="display:none; text-align:center; font-size:12px; color:var(--muted); margin-bottom:8px;">
          ← Scroll horizontally to see all days →
        </div>
        <div id="current-date-info" style="text-align:center; font-size:12px; color:var(--muted); margin-bottom:8px;">
          <!-- Current date will be inserted here by JavaScript -->
        </div>
        <!-- Injected from financial-calendar-10-2025.html with UI-consistent tweaks -->
        <div class="calendar">
          <div class="dow">Sun</div><div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div>
          <div class="cell"></div><div class="cell"></div><div class="cell"></div>
          <div class="cell uwm-window"><div class="day">1</div><ul><li class="bill">NEXT Insurance (Trainer Liability) — $28.08</li><li class="bill">ISSA (subscription) — $16.65</li><li class="bill">BCBS Health Insurance — $45.41</li><li class="bill">Meetup.org — $47.96</li><li class="bill">Travelers (Home Insurance) — $232.33</li><li class="debt">UWM Mortgage (window 1–16) — $2,674.85</li></ul></div>
          <div class="cell uwm-window"><div class="day">2</div><ul><li class="bill">Costco Groceries — $172.80</li></ul></div>
          <div class="cell uwm-window"><div class="day">3</div><ul><li class="bill">Water — $23.69 (1/3 of ~$71.06)</li><li class="bill">Just Energy (Electricity) — $100.00 (1/3 of ~$300.00)</li><li class="income">🏠 Room Rent (Tenant #1) — $600.00</li></ul></div>
          <div class="cell uwm-window"><div class="day">4</div><ul></ul></div>
          <div class="cell uwm-window"><div class="day">5</div><ul><li class="bill">Shopify — $1.07</li><li class="income-payroll">💰 Booz Allen Hamilton Payroll — $1,928.03</li></ul></div>
          <div class="cell uwm-window"><div class="day">6</div><ul></ul></div>
          <div class="cell uwm-window"><div class="day">7</div><ul></ul></div>
          <div class="cell uwm-window"><div class="day">8</div><ul><li class="bill">Spectrum Mobile — $78.33</li><li class="bill">T-Mobile Internet — $70.00</li><li class="income">🏠 Room Rent (Tenant #2) — $640.00</li><li class="bill">Man's T Clinic — $14.63</li></ul></div>
          <div class="cell uwm-window"><div class="day">9</div><ul><li class="debt">Best Egg Loan — $685.43</li></ul></div>
          <div class="cell uwm-window"><div class="day">10</div><ul></ul></div>
          <div class="cell uwm-window"><div class="day">11</div><ul><li class="bill">Quell Pest Control — $47.63</li><li class="bill">Man's T Clinic — $14.63</li><li class="bill">Coursera — $49.00</li></ul></div>
          <div class="cell uwm-window"><div class="day">12</div><ul></ul></div>
          <div class="cell uwm-window"><div class="day">13</div><ul><li class="bill">Payment Plan — $56.00</li></ul></div>
          <div class="cell uwm-window"><div class="day">14</div><ul></ul></div>
          <div class="cell uwm-window"><div class="day">15</div><ul><li class="bill">ISSA (additional) — $92.64</li><li class="bill">Best Buy — $30.00</li><li class="bill">Man's T Clinic — $14.63</li></ul></div>
          <div class="cell uwm-window-end"><div class="day">16</div><div style="font-size: 10px; color: #ff5722; font-weight: 700; text-align: center; margin: 4px 0; background: rgba(255, 87, 34, 0.2); padding: 2px 4px; border-radius: 4px;">⚠️ MORTGAGE PAYMENT WINDOW ENDS</div><ul></ul></div>
          <div class="cell"><div class="day">17</div><ul><li class="bill">Apple Subscription (iCloud/Services) — $21.64</li><li class="bill">Apple Subscription (Other) — $14.06</li><li class="bill">Planet Fitness — $21.65</li></ul></div>
          <div class="cell"><div class="day">18</div><ul><li class="debt">American Express — $575.85</li></ul></div>
          <div class="cell"><div class="day">19</div><ul></ul></div>
          <div class="cell"><div class="day">20</div><ul></ul></div>
          <div class="cell"><div class="day">21</div><ul></ul></div>
          <div class="cell"><div class="day">22</div><ul><li class="bill">Canva — $15.00</li><li class="bill">Super Llama — $23.79</li><li class="bill">Steperton — $13.65</li><li class="bill">Man's T Clinic — $14.63</li><li class="income-payroll">💰 Booz Allen Hamilton Payroll — $1,928.04</li></ul></div>
          <div class="cell"><div class="day">23</div><ul><li class="bill">Heptabase — $11.99</li><li class="debt">Chase — $312.00</li></ul></div>
          <div class="cell"><div class="day">24</div><ul><li class="bill">ISSA (course payment) — $83.33</li><li class="bill">Student Loan (ADVS-ED-SERV PPD) — $81.05</li></ul></div>
          <div class="cell"><div class="day">25</div><ul></ul></div>
          <div class="cell"><div class="day">26</div><ul></ul></div>
          <div class="cell"><div class="day">27</div><ul></ul></div>
          <div class="cell"><div class="day">28</div><ul></ul></div>
          <div class="cell"><div class="day">29</div><ul><li class="bill">Man’s T Clinic — $14.63</li></ul></div>
          <div class="cell"><div class="day">30</div><ul></ul></div>
          <div class="cell"><div class="day">31</div><ul><li class="debt">Apple Card (MacBook Pro) — $408.25</li></ul></div>
          <div class="cell"></div>
        </div>
        <div class="totals">
          <div class="row"><span>Total Money In:</span> <span class="money-in">$5,096.07</span></div>
          <div class="row"><span>Total Money Out:</span> <span class="money-out">$6,107.28</span></div>
          <div class="row"><span>Result (Shortfall if negative):</span> <span style="font-weight:700;color:#ff8b8b;">$-1,011.21</span></div>
          <div class="footer-note" style="margin-top:10px;color:var(--muted);">Note: UWM Mortgage appears on the 1st as a 1–16 day payment window.</div>
        </div>
      </section>
    </main>
    <script>
      (function () {
        const STORAGE_KEY = "fml_overview_access_granted";
        try {
          if (localStorage.getItem(STORAGE_KEY) !== '1') {
            window.location.replace('./index.html');
            return;
          }
        } catch (e) {
          window.location.replace('./index.html');
          return;
        }
        document.getElementById('lock').addEventListener('click', function () {
          try { localStorage.removeItem(STORAGE_KEY); } catch (e) {}
          window.location.replace('./index.html');
        });

        // Show scroll hint on mobile
        if (window.innerWidth <= 767) {
          document.querySelector('.mobile-scroll-hint').style.display = 'block';
        }

        // Highlight current date and show date info
        const today = new Date();
        const currentDay = today.getDate();
        const currentMonth = today.getMonth() + 1; // JavaScript months are 0-indexed
        const currentYear = today.getFullYear();
        
        // Show current date info
        const dateInfoEl = document.getElementById('current-date-info');
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
        const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        dateInfoEl.innerHTML = `Today is ${dayNames[today.getDay()]}, ${monthNames[currentMonth-1]} ${currentDay}, ${currentYear}`;
        
        // Only highlight if we're viewing October 2025
        if (currentMonth === 10 && currentYear === 2025) {
          const dayElements = document.querySelectorAll('.day');
          dayElements.forEach(dayEl => {
            const dayNumber = parseInt(dayEl.textContent);
            if (dayNumber === currentDay) {
              // Find the parent cell and highlight the entire cell
              const cell = dayEl.closest('.cell');
              if (cell) {
                // Border-only glow with animation
                cell.style.backgroundColor = '';
                cell.style.borderColor = '#00ff41';
                cell.style.boxShadow = '0 0 16px rgba(0, 255, 65, 0.45)';
                cell.style.animation = 'todayPulse 2s ease-in-out infinite';
                cell.title = 'Today';
                
                // Add CSS animation
                if (!document.getElementById('today-animation')) {
                  const style = document.createElement('style');
                  style.id = 'today-animation';
                  style.textContent = `
                    @keyframes todayPulse {
                      0%, 100% { box-shadow: 0 0 16px rgba(0, 255, 65, 0.45); }
                      50% { box-shadow: 0 0 24px rgba(0, 255, 65, 0.7); }
                    }
                  `;
                  document.head.appendChild(style);
                }
              }
            }
          });
        } else {
          // If not October 2025, show a note
          dateInfoEl.innerHTML += ' (Calendar shows October 2025)';
        }
      })();
      (function computeDailyBalances(){
        // Current balance as of Oct 8 (user-provided)
        const balanceAfterDay8 = 4613.18;
        const mortgageDay = 15;
        const mortgageAmount = 2674.85; // assumed payment on 15th

        const calendarEl = document.querySelector('.calendar');
        if (!calendarEl) return;
        const dayCells = Array.from(calendarEl.querySelectorAll('.cell'))
          .filter(cell => cell.querySelector('.day'));

        // Build map of day -> net change
        const dayNet = new Map();
        const amountRegex = /\$\s*([0-9]{1,3}(?:,[0-9]{3})*(?:\.[0-9]{2})?|[0-9]+(?:\.[0-9]{2})?)/;

        for (const cell of dayCells) {
          const dayNum = parseInt(cell.querySelector('.day').textContent, 10);
          let net = 0;
          const items = cell.querySelectorAll('li');
          items.forEach(li => {
            // Ignore informational UWM window item; we'll handle the actual payment on the 15th
            const txt = li.textContent || '';
            if (/uwm\s*mortgage.*window/i.test(txt)) return;
            const m = li.textContent.match(amountRegex);
            if (!m) return;
            const amt = parseFloat(m[1].replace(/,/g, ''));
            if (li.classList.contains('income') || li.classList.contains('income-payroll')) {
              net += amt;
            } else if (li.classList.contains('bill') || li.classList.contains('debt')) {
              net -= amt;
            }
          });
          dayNet.set(dayNum, (dayNet.get(dayNum) || 0) + net);
        }

        // Inject synthetic mortgage payment on the 15th if not already represented as an actual subtraction transaction
        dayNet.set(mortgageDay, (dayNet.get(mortgageDay) || 0) - mortgageAmount);

        // Compute running balances and add badges
        // Helper function to create breakdown tooltip (desktop) or modal content (mobile)
        function createBreakdownContent(dayNum, startBalance, addsTotal, subtractsTotal, endBalance, items) {
          let html = `
            <div class="breakdown-line"><span>Starting Balance</span> <span>$${startBalance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></div>
          `;
          
          // Add transactions section
          if (items.length > 0) {
            html += `<div class="breakdown-section">
              <div class="breakdown-section-title">Transactions</div>`;
            items.forEach(item => {
              const amount = item.amount;
              const name = item.name;
              const isPositive = item.isPositive;
              const sign = isPositive ? '+' : '-';
              const colorClass = isPositive ? 'breakdown-positive' : 'breakdown-negative';
              html += `<div class="breakdown-line item"><span>${name}</span> <span class="${colorClass}">${sign}$${amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></div>`;
            });
            html += `</div>`;
          }
          
          // Add synthetic mortgage if applicable
          if (dayNum === mortgageDay) {
            html += `<div class="breakdown-line item"><span>UWM Mortgage Payment</span> <span class="breakdown-negative">-$${mortgageAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></div>`;
          }
          
          // Summary section
          html += `<div class="breakdown-section">
            <div class="breakdown-section-title">Summary</div>
            <div class="breakdown-line"><span>Total Adds</span> <span class="breakdown-positive">+$${addsTotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></div>
            <div class="breakdown-line"><span>Total Subtracts</span> <span class="breakdown-negative">-$${subtractsTotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></div>
          </div>`;
          
          const net = addsTotal - subtractsTotal;
          const netClass = net >= 0 ? 'breakdown-positive' : 'breakdown-negative';
          html += `<div class="breakdown-total"><span>Ending Balance</span> <span class="${netClass}">$${endBalance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></div>`;
          
          return html;
        }

        // Create modal element
        const modal = document.createElement('div');
        modal.className = 'balance-modal';
        modal.innerHTML = `
          <div class="balance-modal-content">
            <div class="balance-modal-header">
              <div class="balance-modal-title">Day Breakdown</div>
              <button class="balance-modal-close" aria-label="Close modal">×</button>
            </div>
            <div class="balance-modal-body"></div>
          </div>
        `;
        document.body.appendChild(modal);

        // Modal event handlers
        const modalClose = modal.querySelector('.balance-modal-close');
        const modalBody = modal.querySelector('.balance-modal-body');
        
        modalClose.addEventListener('click', () => {
          modal.classList.remove('open');
          document.body.style.overflow = '';
        });
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('open');
            document.body.style.overflow = '';
          }
        });

        // Day 8: directly show the provided current balance
        let running = balanceAfterDay8;
        const cellDay8 = dayCells.find(c => parseInt(c.querySelector('.day').textContent, 10) === 8);
        if (cellDay8) {
          const badge8 = document.createElement('div');
          badge8.className = 'balance-badge';
          badge8.textContent = `End: $${running.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
          
          // Create breakdown for day 8
          const day8Items = [];
          const items = cellDay8.querySelectorAll('li');
          items.forEach(li => {
            const txt = li.textContent || '';
            if (/uwm\s*mortgage.*window/i.test(txt)) return;
            const m = li.textContent.match(amountRegex);
            if (!m) return;
            const amt = parseFloat(m[1].replace(/,/g, ''));
            const name = li.textContent.split(' — ')[0] || 'Unknown';
            const isPositive = li.classList.contains('income') || li.classList.contains('income-payroll');
            day8Items.push({ name, amount: amt, isPositive });
          });
          const adds8 = day8Items.filter(i => i.isPositive).reduce((s, i) => s + i.amount, 0);
          const subs8 = day8Items.filter(i => !i.isPositive).reduce((s, i) => s + i.amount, 0);
          const start8 = running - (adds8 - subs8);
          // Create tooltip for desktop
          const tooltip8 = document.createElement('div');
          tooltip8.className = 'balance-tooltip';
          tooltip8.innerHTML = `
            <div class="balance-tooltip-header">
              <div class="balance-tooltip-title">Day 8 Breakdown</div>
              <button class="balance-tooltip-close" aria-label="Close tooltip">×</button>
            </div>
            ${createBreakdownContent(8, start8, adds8, subs8, running, day8Items)}
          `;
          
          // Add close button functionality
          const closeBtn8 = tooltip8.querySelector('.balance-tooltip-close');
          closeBtn8.addEventListener('click', (e) => {
            e.stopPropagation();
            badge8.classList.remove('open');
            badge8.setAttribute('aria-expanded', 'false');
          });
          
          badge8.appendChild(tooltip8);
          
          if (running < 0) {
            badge8.classList.add('balance-neg');
          } else if (running < 300) {
            badge8.classList.add('balance-low');
          } else {
            badge8.classList.add('balance-pos');
          }
          cellDay8.appendChild(badge8);
        }

        // Days 1..7: calculate backwards from day 8
        let runningBackwards = running;
        for (let d = 7; d >= 1; d--) {
          const cell = dayCells.find(c => parseInt(c.querySelector('.day').textContent, 10) === d);
          if (!cell) continue;
          
          // Calculate net change for this day
          let dayNet = 0;
          const items = cell.querySelectorAll('li');
          items.forEach(li => {
            const txt = li.textContent || '';
            if (/uwm\s*mortgage.*window/i.test(txt)) return;
            const m = li.textContent.match(amountRegex);
            if (!m) return;
            const amt = parseFloat(m[1].replace(/,/g, ''));
            const isPositive = li.classList.contains('income') || li.classList.contains('income-payroll');
            dayNet += isPositive ? amt : -amt;
          });
          
          // Subtract the day's net to get the starting balance
          runningBackwards -= dayNet;
          
          const badge = document.createElement('div');
          badge.className = 'balance-badge';
          badge.textContent = `End: $${runningBackwards.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
          
          if (runningBackwards < 0) {
            badge.classList.add('balance-neg');
          } else if (runningBackwards < 300) {
            badge.classList.add('balance-low');
          } else {
            badge.classList.add('balance-pos');
          }
          
          cell.appendChild(badge);
        }

        // Days 9..31: accumulate from the provided day-8 ending balance
        for (let d = 9; d <= 31; d++) {
          const start = running;
          const cell = dayCells.find(c => parseInt(c.querySelector('.day').textContent, 10) === d);
          if (!cell) continue;
          const badge = document.createElement('div');
          badge.className = 'balance-badge';
          
          
          // Create breakdown for this day
          const dayItems = [];
          const items = cell.querySelectorAll('li');
          items.forEach(li => {
            const txt = li.textContent || '';
            if (/uwm\s*mortgage.*window/i.test(txt)) return;
            const m = li.textContent.match(amountRegex);
            if (!m) return;
            const amt = parseFloat(m[1].replace(/,/g, ''));
            const name = li.textContent.split(' — ')[0] || 'Unknown';
            const isPositive = li.classList.contains('income') || li.classList.contains('income-payroll');
            dayItems.push({ name, amount: amt, isPositive });
          });
          const adds = dayItems.filter(i => i.isPositive).reduce((s, i) => s + i.amount, 0);
          let subs = dayItems.filter(i => !i.isPositive).reduce((s, i) => s + i.amount, 0);
          if (d === mortgageDay) subs += mortgageAmount; // include synthetic mortgage payment
          const end = start + adds - subs;
          running = end;
          badge.textContent = `End: $${end.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
          // Create tooltip for desktop
          const tooltip = document.createElement('div');
          tooltip.className = 'balance-tooltip';
          tooltip.innerHTML = `
            <div class="balance-tooltip-header">
              <div class="balance-tooltip-title">Day ${d} Breakdown</div>
              <button class="balance-tooltip-close" aria-label="Close tooltip">×</button>
            </div>
            ${createBreakdownContent(d, start, adds, subs, end, dayItems)}
          `;
          
          // Add close button functionality
          const closeBtn = tooltip.querySelector('.balance-tooltip-close');
          closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            badge.classList.remove('open');
            badge.setAttribute('aria-expanded', 'false');
          });
          
          badge.appendChild(tooltip);
          
          // Color thresholds
          if (end < 0) {
            badge.classList.add('balance-neg');
          } else if (end < 300) {
            badge.classList.add('balance-low');
          } else {
            badge.classList.add('balance-pos');
          }
          cell.appendChild(badge);
        }

        // Enable tap/click to toggle tooltips (mobile-friendly)
        const closeAllTooltips = () => {
          document.querySelectorAll('.balance-badge.open').forEach(b => b.classList.remove('open'));
        };
        
        // Close tooltips when clicking outside
        document.addEventListener('click', (e) => {
          const target = e.target;
          if (!(target instanceof Element)) return;
          if (!target.closest('.balance-badge') && !target.closest('.balance-tooltip')) {
            closeAllTooltips();
          }
        });
        
        // Close tooltips on scroll (mobile UX improvement)
        let scrollTimeout;
        document.addEventListener('scroll', () => {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => {
            closeAllTooltips();
          }, 150);
        }, { passive: true });
        
        document.querySelectorAll('.balance-badge').forEach(badge => {
          badge.setAttribute('tabindex', '0');
          badge.setAttribute('role', 'button');
          badge.setAttribute('aria-expanded', 'false');
          badge.setAttribute('aria-label', 'View daily balance breakdown');
          
          const toggle = (ev) => {
            ev.stopPropagation();
            ev.preventDefault();
            
            // Check if mobile
            const isMobile = window.innerWidth <= 767;
            
            if (isMobile) {
              // Use modal on mobile
              const dayNum = parseInt(badge.closest('.cell').querySelector('.day').textContent, 10);
              const modalTitle = modal.querySelector('.balance-modal-title');
              modalTitle.textContent = `Day ${dayNum} Breakdown`;
              
              // Get the breakdown content from the tooltip
              const tooltipContent = badge.querySelector('.balance-tooltip');
              if (tooltipContent) {
                const content = tooltipContent.innerHTML.replace(/<div class="balance-tooltip-header">.*?<\/div>/s, '');
                modalBody.innerHTML = content;
              }
              
              modal.classList.add('open');
              document.body.style.overflow = 'hidden';
            } else {
              // Use tooltip on desktop
              const isOpen = badge.classList.toggle('open');
              badge.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            }
          };
          
          badge.addEventListener('click', toggle);
          badge.addEventListener('touchstart', toggle, { passive: false });
          badge.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter' || ev.key === ' ') {
              ev.preventDefault();
              toggle(ev);
            }
            if (ev.key === 'Escape') {
              badge.classList.remove('open');
              badge.setAttribute('aria-expanded', 'false');
            }
          });
        });
        
        // Prevent body scroll when tooltip is open on mobile
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              const hasOpenTooltip = document.querySelector('.balance-badge.open');
              if (window.innerWidth <= 767) {
                if (hasOpenTooltip) {
                  document.body.style.overflow = 'hidden';
                } else {
                  document.body.style.overflow = '';
                }
              }
            }
          });
        });
        
        document.querySelectorAll('.balance-badge').forEach(badge => {
          observer.observe(badge, { attributes: true });
        });
      })();
    </script>
  </body>
  </html>


